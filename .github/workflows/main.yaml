name: Stroke prediction github actions
on:
  push:
    branches:
      - prod
  workflow_dispatch:
    inputs:
      manualExecution:
        required: true
        description: Allow manual invocation
        type: choice
        options:
          - dev
          - stage
          - prod
        default: prod
jobs:
  job1:
    name: Run test
    runs-on: ubuntu-20.04
    steps:
      - id: step1
        name: checkout
        uses: actions/checkout@v2
      - id: step2
        name: download and setup python version
        uses: actions/setup-python@v3
        with:
          python-version: 3.10.0
          cache: pip
      - id: step3
        name: Install packages
        shell: bash
        run: |
          pip install -r requirements.txt
      - id: step4
        name: build and test model
        shell: bash
        run: |
          pytest -v -s
  job2:
    name: Build and save model as artifact
    runs-on: ubuntu-20.04
    steps:
      - id: step1
        name: checkout
        uses: actions/checkout@v2
      - id: step2
        name: download and setup python version
        uses: actions/setup-python@v3
        with:
          python-version: 3.10.0
          cache: pip
      - id: step3
        name: Install packages
        shell: bash
        run: |
          pip install -r requirements.txt
      - id: step4
        name: Build model
        shell: bash
        run: |
          python3 build.py
      - id: step5
        name: Upload model as artifact
        uses: actions/upload-artifact@v3
        with:
          name: model
          path: model.pkl
          retension-days: 1