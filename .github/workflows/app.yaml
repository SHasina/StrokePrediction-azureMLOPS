name: Test
on:
  push:
    branches:
      - prod
jobs:
  job1:
    name: testing azure cli
    runs-on: ubuntu-latest
    env:
      CONTAINER_APP_NAME: msk-dev-signup
    steps:
      - id: step1
        name: azure login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
      
      - id: step2
        name: install container app extension
        shell: bash
        run: |
          az extension add -n containerapp
      
      - id: step3
        name: Get containerapp name
        shell: bash
        run: |
          OUTPUT=$(az containerapp show --name $CONTAINER_APP_NAME --resource-group $CONTAINER_APP_NAME --query "name" -o tsv | tr -d '[:space:]') &&
          echo $OUTPUT &&
          echo "::set-output name=OUTPUT::$OUTPUT"

      - id: step4
        if: ${{ steps.step3.outputs.OUTPUT == env.CONTAINER_APP_NAME }}
        name: Update containerapp if exists
        shell: bash
        run: |
          echo "Update old containerapp"
      
      - id: step5
        if: ${{ steps.step3.outputs.OUTPUT != env.CONTAINER_APP_NAME }}
        name: Deploy new containerapp if not exists
        shell: bash
        run: |
          echo "Deploy new containerapp"